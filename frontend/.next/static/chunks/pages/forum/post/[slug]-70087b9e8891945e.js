(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{2840:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/forum/post/[slug]",function(){return t(7101)}])},3576:(e,s,t)=>{"use strict";t.d(s,{L:()=>a,m:()=>o});var r=t(2009);let o=async(e,s)=>{if(!e)throw Error("Firestore instance is required to create a forum post.");let t=(0,r.rJ)(e,"forumPosts");await (0,r.gS)(t,{...s,helpfulVoteCount:0,notHelpfulVoteCount:0,answerCount:0,timestamp:(0,r.O5)()})},a=async(e,s)=>{if(!e)throw Error("Firestore instance is required to delete a forum post.");let t=(0,r.H9)(e,"forumPosts",s);await (0,r.kd)(t)}},7101:(e,s,t)=>{"use strict";t.r(s),t.d(s,{__N_SSP:()=>g,default:()=>y});var r=t(7876),o=t(2009),a=t(7328),n=t.n(a),i=t(9099),l=t(4232),d=t(3276),c=t(7685),u=t(6845),m=t(3783),p=t(7858),h=t(3576),w=t(3233);let f=e=>{var s;let{postId:t,firebaseAuth:a,firebaseDb:p,initialPostData:f,ssrError:g}=e,y=(0,i.useRouter)(),[x,j]=(0,l.useState)(f||null),[v,b]=(0,l.useState)([]),[N,C]=(0,l.useState)(""),[P,A]=(0,l.useState)(!f),[D,E]=(0,l.useState)(!1),[S,I]=(0,l.useState)(!1),[V,_]=(0,d.hD)(a),k=(null==V?void 0:V.uid)===(null==x?void 0:x.authorId);(0,l.useEffect)(()=>{if(!p){A(!1),g&&c.Ay.error(g);return}(async()=>{if(f||g)g&&!f&&c.Ay.error("Error loading post: ".concat(g));else{A(!0);try{let e=(0,o.H9)(p,"forumPosts",t),s=await (0,o.x7)(e);s.exists()?j({id:s.id,...s.data()}):(c.Ay.error("Post not found (client-side)."),j(null))}catch(e){console.error("ViewPostPage: Error loading post (client-side):"),c.Ay.error("Error loading post content (client-side)."),j(null)}}try{let e=(0,o.rJ)(p,"forumPosts",t,"answers"),s=(0,o.P)(e,(0,o.My)("timestamp","desc")),r=await (0,o.GG)(s);b(r.docs.map(e=>({id:e.id,...e.data()})))}catch(e){console.error("ViewPostPage: Error loading answers (client-side):"),c.Ay.error("Error loading answers.")}finally{A(!1)}})()},[t,p,f,g]);let H=async()=>{if(!t||!p)return void c.Ay.error("Cannot submit answer: Services not ready or Post ID is missing.");if(!V)return void E(!0);if(!N.trim())return void c.Ay.error("Answer cannot be empty.");I(!0);let e={content:N.trim(),authorId:V.uid,postId:t,timestamp:(0,o.O5)(),authorDisplayName:V.displayName||"Anonymous User",helpfulVoteCount:0,notHelpfulVoteCount:0};try{let s=(0,o.rJ)(p,"forumPosts",t,"answers"),r=await (0,o.gS)(s,e),a={...e,id:r.id,timestamp:new Date};if(b(e=>[a,...e]),C(""),x){let e=(0,o.H9)(p,"forumPosts",t);await (0,o.mZ)(e,{answerCount:(x.answerCount||0)+1}),j(e=>e?{...e,answerCount:(e.answerCount||0)+1}:null)}c.Ay.success("Answer posted successfully!")}catch(e){console.error("ViewPostPage: Error posting answer:",e),c.Ay.error(e instanceof Error?e.message:"Failed to post answer.")}finally{I(!1)}},L=async()=>{if((null==x?void 0:x.id)&&p&&window.confirm("Are you sure you want to delete this post?"))try{await (0,h.L)(p,x.id),c.Ay.success("Post deleted successfully!"),y.push("/forum")}catch(e){c.Ay.error("Failed to delete post.")}},F=async e=>{if(t&&e&&p&&window.confirm("Are you sure you want to delete this answer?"))try{if(await (0,o.kd)((0,o.H9)(p,"forumPosts",t,"answers",e)),b(s=>s.filter(s=>s.id!==e)),x&&"number"==typeof x.answerCount&&x.answerCount>0){let e=(0,o.H9)(p,"forumPosts",t);await (0,o.mZ)(e,{answerCount:x.answerCount-1}),j(e=>e?{...e,answerCount:e.answerCount-1}:null)}c.Ay.success("Answer deleted successfully.")}catch(e){c.Ay.error(e instanceof Error?e.message:"Failed to delete answer.")}};if(_||P)return(0,r.jsx)("div",{className:"page-loading-indicator",children:"Loading post details..."});if(g&&!x)return(0,r.jsxs)("div",{className:"page-error-indicator",children:[(0,r.jsx)(n(),{children:(0,r.jsx)("title",{children:"Error Loading Post"})}),"Error: ",g]});if(!x)return(0,r.jsxs)("div",{className:"page-error-indicator",children:[(0,r.jsx)(n(),{children:(0,r.jsx)("title",{children:"Post Not Found"})}),"Post not found or error loading data."]});let T=x.title?"".concat(x.title," | Dollars & Life Forum"):"Forum Post | Dollars & Life",z=(null==(s=x.content)?void 0:s.substring(0,160).replace(/<[^>]*>/g,""))||"View discussion on a forum post.";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n(),{children:[(0,r.jsx)("title",{children:T}),(0,r.jsx)("meta",{name:"description",content:z}),x&&(0,r.jsx)("link",{rel:"canonical",href:"https://www.dollarsandlife.com/forum/post/".concat(x.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""))})]}),(0,r.jsxs)("div",{className:"view-post-container ".concat(D?"blurred":""),children:[(0,r.jsx)("h1",{children:x.title}),(0,r.jsxs)("div",{className:"post-meta-row",children:[(0,r.jsxs)("div",{className:"post-meta-info-group",children:[(0,r.jsxs)("span",{children:["By: ",x.authorDisplayName||"Anonymous User"]}),(0,r.jsx)("span",{className:"post-meta-separator-mobile",children:" • "}),(0,r.jsx)("span",{children:(()=>{let e=x.timestamp;return e&&"object"==typeof e&&"seconds"in e&&"number"==typeof e.seconds?new Date(1e3*e.seconds).toLocaleDateString():e instanceof Date?e.toLocaleDateString():"Date unavailable"})()}),(0,r.jsx)("span",{className:"post-meta-separator-mobile",children:" • "}),(0,r.jsxs)("span",{children:[x.answerCount||0," Answers"]})]}),k&&(0,r.jsx)("button",{className:"delete-post-button",onClick:L,disabled:!p,children:"Delete Post \uD83D\uDDD1️"})]}),(0,r.jsx)("div",{className:"post-content",dangerouslySetInnerHTML:{__html:x.content}}),x.tags&&x.tags.length>0&&(0,r.jsx)("div",{className:"post-tags",children:x.tags.map(e=>{let s=w.A[e.toLowerCase()]||{bg:"#e9ecef",text:"#495057"};return(0,r.jsx)("span",{className:"tag-pill",style:{backgroundColor:s.bg,color:s.text,borderColor:"#e9ecef"!==s.bg?s.bg:"#dee2e6"},children:e.replace(/\b\w/g,e=>e.toUpperCase())},e)})}),(0,r.jsx)("div",{className:"vote-buttons-wrapper-viewpost",children:(0,r.jsx)(m.A,{itemId:x.id,initialHelpfulVotes:x.helpfulVoteCount,initialNotHelpfulVotes:x.notHelpfulVoteCount,itemType:"post",itemAuthorId:x.authorId,auth:a,db:p})}),(0,r.jsxs)("div",{className:"answer-form",children:[(0,r.jsx)("h3",{children:"Post Your Answer"}),V?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("textarea",{placeholder:"Share your knowledge...",value:N,onChange:e=>C(e.target.value),rows:5,disabled:S||!p}),(0,r.jsx)("button",{onClick:H,disabled:!N.trim()||S||!p,children:S?"Submitting...":"Post Answer"})]}):(0,r.jsx)("div",{className:"answer-form-prompt",children:(0,r.jsxs)("p",{children:["Please"," ",(0,r.jsxs)("button",{className:"link-button",onClick:()=>E(!0),children:[" ","log in"," "]})," ","or"," ",(0,r.jsxs)("button",{className:"link-button",onClick:()=>E(!0),children:[" ","sign up"," "]})," ","to post an answer."]})})]}),(0,r.jsxs)("div",{className:"answers-section",id:"answers",children:[(0,r.jsxs)("h3",{children:[v&&v.length||0," Answers"]}),v&&v.length>0?(0,r.jsx)("div",{className:"answers-list",children:v.map(e=>(0,r.jsxs)("div",{className:"answer-card",children:[(0,r.jsx)("div",{className:"answer-text",children:e.content}),(0,r.jsxs)("div",{className:"answer-meta",children:[(0,r.jsxs)("span",{children:["By: ",e.authorDisplayName||"Anonymous User"]}),(0,r.jsx)("span",{children:(()=>{let s=e.timestamp;return s&&"object"==typeof s&&"seconds"in s&&"number"==typeof s.seconds?new Date(1e3*s.seconds).toLocaleDateString():s instanceof Date?s.toLocaleDateString():"A moment ago"})()}),(null==V?void 0:V.uid)===e.authorId&&(0,r.jsx)("button",{className:"delete-answer-button",onClick:()=>F(e.id),disabled:!p,children:"Delete ❌"})]}),(0,r.jsx)("div",{className:"vote-buttons-wrapper-answer",children:(0,r.jsx)(m.A,{itemId:e.id,initialHelpfulVotes:e.helpfulVoteCount||0,initialNotHelpfulVotes:e.notHelpfulVoteCount||0,itemType:"answer",itemAuthorId:e.authorId,postIdForItem:t,auth:a,db:p})})]},e.id))}):(0,r.jsx)("p",{className:"no-answers-yet",children:"No answers yet. Be the first to respond!"})]})]}),D&&(0,r.jsx)(u.A,{onClose:()=>E(!1),auth:a})]})};var g=!0;let y=e=>{let{initialPostData:s,error:t}=e,o=(0,i.useRouter)(),{postId:a}=o.query,[n,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[w,g]=(0,l.useState)(null);if((0,l.useEffect)(()=>{(0,p.lo)().then(e=>{let{auth:s,db:t}=e;d(s),u(t),h(!0)}).catch(e=>{console.error("ViewPostPage: Firebase initialization failed:",e),g(e),h(!0)})},[]),!o.isReady&&!s&&!t)return(0,r.jsx)("div",{className:"page-loading-indicator",children:"Loading router..."});let y="string"==typeof a?a:null==s?void 0:s.id;return y?m?w?(0,r.jsxs)("div",{className:"page-error-indicator",children:["Error initializing Firebase: ",w.message,". Please try refreshing."]}):n?(0,r.jsx)(f,{postId:y,firebaseAuth:n,firebaseDb:c,initialPostData:s,ssrError:t}):(0,r.jsx)("div",{className:"page-error-indicator",children:"Authentication service could not be loaded. Please try refreshing."}):(0,r.jsx)("div",{className:"page-loading-indicator",children:"Initializing services..."}):(0,r.jsx)("div",{className:"page-error-indicator",children:"Error: Post ID is missing or invalid."})}}},e=>{var s=s=>e(e.s=s);e.O(0,[121,855,636,792],()=>s(2840)),_N_E=e.O()}]);