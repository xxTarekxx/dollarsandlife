"use strict";(()=>{var e={};e.id=300,e.ids=[300,636],e.modules={361:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},2015:e=>{e.exports=require("react")},2326:e=>{e.exports=require("react-dom")},2770:e=>{e.exports=require("styled-components")},2893:e=>{e.exports=import("react-hot-toast")},2965:e=>{e.exports=require("react-firebase-hooks/auth")},3873:e=>{e.exports=require("path")},4075:e=>{e.exports=require("zlib")},4337:e=>{e.exports=import("firebase/firestore")},4641:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>f,default:()=>u,getServerSideProps:()=>g,getStaticPaths:()=>m,getStaticProps:()=>p,reportWebVitals:()=>h,routeModule:()=>y,unstable_getServerProps:()=>P,unstable_getServerSideProps:()=>v,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>x,unstable_getStaticProps:()=>w});var o=r(3885),a=r(237),i=r(1413),n=r(8874),l=r(2386),d=r(7666),c=e([d,l]);[d,l]=c.then?(await c)():c;let u=(0,i.M)(d,"default"),p=(0,i.M)(d,"getStaticProps"),m=(0,i.M)(d,"getStaticPaths"),g=(0,i.M)(d,"getServerSideProps"),f=(0,i.M)(d,"config"),h=(0,i.M)(d,"reportWebVitals"),w=(0,i.M)(d,"unstable_getStaticProps"),x=(0,i.M)(d,"unstable_getStaticPaths"),b=(0,i.M)(d,"unstable_getStaticParams"),P=(0,i.M)(d,"unstable_getServerProps"),v=(0,i.M)(d,"unstable_getServerSideProps"),y=new o.PagesRouteModule({definition:{kind:a.A.PAGES,page:"/forum/post/[slug]",pathname:"/forum/post/[slug]",bundlePath:"",filename:""},components:{App:l.default,Document:n.default},userland:d});s()}catch(e){s(e)}})},6551:e=>{e.exports=import("firebase/app")},6958:e=>{e.exports=import("firebase/auth")},7666:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>P,getServerSideProps:()=>b});var o=r(8732),a=r(4337),i=r(9788),n=r.n(i),l=r(4233),d=r(2015),c=r(2965),u=r(2893),p=r(480),m=r(9924),g=r(1173),f=r(8703),h=r(3920),w=e([a,u,f,m,p,g]);[a,u,f,m,p,g]=w.then?(await w)():w;let x=({postId:e,firebaseAuth:t,firebaseDb:r,initialPostData:s,ssrError:i})=>{let g=(0,l.useRouter)(),[w,x]=(0,d.useState)(s||null),[b,P]=(0,d.useState)([]),[v,y]=(0,d.useState)(""),[S,j]=(0,d.useState)(!s),[D,N]=(0,d.useState)(!1),[C,A]=(0,d.useState)(!1),[I,E]=(0,c.useAuthState)(t),F=I?.uid===w?.authorId;(0,d.useEffect)(()=>{if(!r){j(!1),i&&u.default.error(i);return}(async()=>{if(s||i)i&&!s&&u.default.error(`Error loading post: ${i}`);else{j(!0);try{let t=(0,a.doc)(r,"forumPosts",e),s=await (0,a.getDoc)(t);s.exists()?x({id:s.id,...s.data()}):(u.default.error("Post not found (client-side)."),x(null))}catch{console.error("ViewPostPage: Error loading post (client-side):"),u.default.error("Error loading post content (client-side)."),x(null)}}try{let t=(0,a.collection)(r,"forumPosts",e,"answers"),s=(0,a.query)(t,(0,a.orderBy)("timestamp","desc")),o=await (0,a.getDocs)(s);P(o.docs.map(e=>({id:e.id,...e.data()})))}catch{console.error("ViewPostPage: Error loading answers (client-side):"),u.default.error("Error loading answers.")}finally{j(!1)}})()},[e,r,s,i]);let V=async()=>{if(!e||!r)return void u.default.error("Cannot submit answer: Services not ready or Post ID is missing.");if(!I)return void N(!0);if(!v.trim())return void u.default.error("Answer cannot be empty.");A(!0);let t={content:v.trim(),authorId:I.uid,postId:e,timestamp:(0,a.serverTimestamp)(),authorDisplayName:I.displayName||"Anonymous User",helpfulVoteCount:0,notHelpfulVoteCount:0};try{let s=(0,a.collection)(r,"forumPosts",e,"answers"),o=await (0,a.addDoc)(s,t),i={...t,id:o.id,timestamp:new Date};if(P(e=>[i,...e]),y(""),w){let t=(0,a.doc)(r,"forumPosts",e);await (0,a.updateDoc)(t,{answerCount:(w.answerCount||0)+1}),x(e=>e?{...e,answerCount:(e.answerCount||0)+1}:null)}u.default.success("Answer posted successfully!")}catch(e){console.error("ViewPostPage: Error posting answer:",e),u.default.error(e instanceof Error?e.message:"Failed to post answer.")}finally{A(!1)}},q=async()=>{if(w?.id&&r&&window.confirm("Are you sure you want to delete this post?"))try{await (0,f.L)(r,w.id),u.default.success("Post deleted successfully!"),g.push("/forum")}catch{u.default.error("Failed to delete post.")}},L=async t=>{if(e&&t&&r&&window.confirm("Are you sure you want to delete this answer?"))try{if(await (0,a.deleteDoc)((0,a.doc)(r,"forumPosts",e,"answers",t)),P(e=>e.filter(e=>e.id!==t)),w&&"number"==typeof w.answerCount&&w.answerCount>0){let t=(0,a.doc)(r,"forumPosts",e);await (0,a.updateDoc)(t,{answerCount:w.answerCount-1}),x(e=>e?{...e,answerCount:e.answerCount-1}:null)}u.default.success("Answer deleted successfully.")}catch(e){u.default.error(e instanceof Error?e.message:"Failed to delete answer.")}};if(E||S)return(0,o.jsx)("div",{className:"page-loading-indicator",children:"Loading post details..."});if(i&&!w)return(0,o.jsxs)("div",{className:"page-error-indicator",children:[(0,o.jsx)(n(),{children:(0,o.jsx)("title",{children:"Error Loading Post"})}),"Error: ",i]});if(!w)return(0,o.jsxs)("div",{className:"page-error-indicator",children:[(0,o.jsx)(n(),{children:(0,o.jsx)("title",{children:"Post Not Found"})}),"Post not found or error loading data."]});let k=w.title?`${w.title} | Dollars & Life Forum`:"Forum Post | Dollars & Life",M=w.content?.substring(0,160).replace(/<[^>]*>/g,"")||"View discussion on a forum post.";return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n(),{children:[(0,o.jsx)("title",{children:k}),(0,o.jsx)("meta",{name:"description",content:M}),w&&(0,o.jsx)("link",{rel:"canonical",href:`https://www.dollarsandlife.com/forum/post/${w.title.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}`})]}),(0,o.jsxs)("div",{className:`view-post-container ${D?"blurred":""}`,children:[(0,o.jsx)("h1",{children:w.title}),(0,o.jsxs)("div",{className:"post-meta-row",children:[(0,o.jsxs)("div",{className:"post-meta-info-group",children:[(0,o.jsxs)("span",{children:["By: ",w.authorDisplayName||"Anonymous User"]}),(0,o.jsx)("span",{className:"post-meta-separator-mobile",children:" • "}),(0,o.jsx)("span",{children:(()=>{let e=w.timestamp;return e&&"object"==typeof e&&"seconds"in e&&"number"==typeof e.seconds?new Date(1e3*e.seconds).toLocaleDateString():e instanceof Date?e.toLocaleDateString():"Date unavailable"})()}),(0,o.jsx)("span",{className:"post-meta-separator-mobile",children:" • "}),(0,o.jsxs)("span",{children:[w.answerCount||0," Answers"]})]}),F&&(0,o.jsx)("button",{className:"delete-post-button",onClick:q,disabled:!r,children:"Delete Post \uD83D\uDDD1️"})]}),(0,o.jsx)("div",{className:"post-content",dangerouslySetInnerHTML:{__html:w.content}}),w.tags&&w.tags.length>0&&(0,o.jsx)("div",{className:"post-tags",children:w.tags.map(e=>{let t=h.A[e.toLowerCase()]||{bg:"#e9ecef",text:"#495057"};return(0,o.jsx)("span",{className:"tag-pill",style:{backgroundColor:t.bg,color:t.text,borderColor:"#e9ecef"!==t.bg?t.bg:"#dee2e6"},children:e.replace(/\b\w/g,e=>e.toUpperCase())},e)})}),(0,o.jsx)("div",{className:"vote-buttons-wrapper-viewpost",children:(0,o.jsx)(m.A,{itemId:w.id,initialHelpfulVotes:w.helpfulVoteCount,initialNotHelpfulVotes:w.notHelpfulVoteCount,itemType:"post",itemAuthorId:w.authorId,auth:t,db:r})}),(0,o.jsxs)("div",{className:"answer-form",children:[(0,o.jsx)("h3",{children:"Post Your Answer"}),I?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("textarea",{placeholder:"Share your knowledge...",value:v,onChange:e=>y(e.target.value),rows:5,disabled:C||!r}),(0,o.jsx)("button",{onClick:V,disabled:!v.trim()||C||!r,children:C?"Submitting...":"Post Answer"})]}):(0,o.jsx)("div",{className:"answer-form-prompt",children:(0,o.jsxs)("p",{children:["Please"," ",(0,o.jsxs)("button",{className:"link-button",onClick:()=>N(!0),children:[" ","log in"," "]})," ","or"," ",(0,o.jsxs)("button",{className:"link-button",onClick:()=>N(!0),children:[" ","sign up"," "]})," ","to post an answer."]})})]}),(0,o.jsxs)("div",{className:"answers-section",id:"answers",children:[(0,o.jsxs)("h3",{children:[b&&b.length||0," Answers"]}),b&&b.length>0?(0,o.jsx)("div",{className:"answers-list",children:b.map(s=>(0,o.jsxs)("div",{className:"answer-card",children:[(0,o.jsx)("div",{className:"answer-text",children:s.content}),(0,o.jsxs)("div",{className:"answer-meta",children:[(0,o.jsxs)("span",{children:["By: ",s.authorDisplayName||"Anonymous User"]}),(0,o.jsx)("span",{children:(()=>{let e=s.timestamp;return e&&"object"==typeof e&&"seconds"in e&&"number"==typeof e.seconds?new Date(1e3*e.seconds).toLocaleDateString():e instanceof Date?e.toLocaleDateString():"A moment ago"})()}),I?.uid===s.authorId&&(0,o.jsx)("button",{className:"delete-answer-button",onClick:()=>L(s.id),disabled:!r,children:"Delete ❌"})]}),(0,o.jsx)("div",{className:"vote-buttons-wrapper-answer",children:(0,o.jsx)(m.A,{itemId:s.id,initialHelpfulVotes:s.helpfulVoteCount||0,initialNotHelpfulVotes:s.notHelpfulVoteCount||0,itemType:"answer",itemAuthorId:s.authorId,postIdForItem:e,auth:t,db:r})})]},s.id))}):(0,o.jsx)("p",{className:"no-answers-yet",children:"No answers yet. Be the first to respond!"})]})]}),D&&(0,o.jsx)(p.A,{onClose:()=>N(!1),auth:t})]})},b=async e=>{let{slug:t}=e.params||{};if(!t||"string"!=typeof t)return console.log("getServerSideProps: No slug parameter provided"),{notFound:!0};function s(e){return e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}try{let{collection:e,getDocs:o,doc:a,getDoc:i}=await Promise.resolve().then(r.bind(r,4337)),{initializeFirebaseAndGetServices:n}=await Promise.resolve().then(r.bind(r,1173)),{db:l}=await n();if(t.length>20&&/^[a-zA-Z0-9]+$/.test(t)){console.log("getServerSideProps: Treating as Firestore ID:",t);let e=a(l,"forumPosts",t),r=await i(e);if(!r.exists())return console.log("getServerSideProps: Post not found by ID"),{notFound:!0};{let e=r.data(),t=s(e.title||"");if(t)return console.log("getServerSideProps: Redirecting from ID to slug:",t),{redirect:{destination:`/forum/post/${t}`,permanent:!0}};return{props:{initialPostData:{id:r.id,...e}}}}}console.log("getServerSideProps: Treating as slug, fetching all posts");let d=e(l,"forumPosts"),c=await o(d),u=null;for(let e of c.docs){let r=e.data();if(s(r.title||"")===t){u={id:e.id,...r};break}}if(u)return console.log("getServerSideProps: Found post by slug"),{props:{initialPostData:u}};return console.log("getServerSideProps: Post not found by slug"),{notFound:!0}}catch(e){return console.error("getServerSideProps: Error in getServerSideProps for forum post by slug:",e),{props:{initialPostData:null,error:"Server error fetching post by slug."}}}},P=({initialPostData:e,error:t})=>{let r=(0,l.useRouter)(),{postId:s}=r.query,[a,i]=(0,d.useState)(null),[n,c]=(0,d.useState)(null),[u,p]=(0,d.useState)(!1),[m,f]=(0,d.useState)(null);if((0,d.useEffect)(()=>{(0,g.initializeFirebaseAndGetServices)().then(({auth:e,db:t})=>{i(e),c(t),p(!0)}).catch(e=>{console.error("ViewPostPage: Firebase initialization failed:",e),f(e),p(!0)})},[]),!r.isReady&&!e&&!t)return(0,o.jsx)("div",{className:"page-loading-indicator",children:"Loading router..."});let h="string"==typeof s?s:e?.id;return h?u?m?(0,o.jsxs)("div",{className:"page-error-indicator",children:["Error initializing Firebase: ",m.message,". Please try refreshing."]}):a?(0,o.jsx)(x,{postId:h,firebaseAuth:a,firebaseDb:n,initialPostData:e,ssrError:t}):(0,o.jsx)("div",{className:"page-error-indicator",children:"Authentication service could not be loaded. Please try refreshing."}):(0,o.jsx)("div",{className:"page-loading-indicator",children:"Initializing services..."}):(0,o.jsx)("div",{className:"page-error-indicator",children:"Error: Post ID is missing or invalid."})};s()}catch(e){s(e)}})},7910:e=>{e.exports=require("stream")},8703:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{L:()=>n,m:()=>i});var o=r(4337),a=e([o]);o=(a.then?(await a)():a)[0];let i=async(e,t)=>{if(!e)throw Error("Firestore instance is required to create a forum post.");let r=(0,o.collection)(e,"forumPosts");await (0,o.addDoc)(r,{...t,helpfulVoteCount:0,notHelpfulVoteCount:0,answerCount:0,timestamp:(0,o.serverTimestamp)()})},n=async(e,t)=>{if(!e)throw Error("Firestore instance is required to delete a forum post.");let r=(0,o.doc)(e,"forumPosts",t);await (0,o.deleteDoc)(r)};s()}catch(e){s(e)}})},8732:e=>{e.exports=require("react/jsx-runtime")},9021:e=>{e.exports=require("fs")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[89,705,341,386,55],()=>r(4641));module.exports=s})();